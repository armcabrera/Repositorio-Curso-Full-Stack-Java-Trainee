--SE ELIMINAN LAS TABLAS 

DROP TABLE ACCIDENTE
DROP TABLE ASISTENTES
DROP TABLE CAPACITACION
DROP TABLE PAGOSCLIENTE
DROP TABLE CHEQUEOVISITA
DROP TABLE VISITA
DROP TABLE CHEQUEOS
DROP TABLE CLIENTE
DROP TABLE ADMINISTRATIVO
DROP TABLE MEJORAS
DROP TABLE ASESORIAS
DROP TABLE PROFESIONAL
DROP TABLE USUARIOS

--SE ELIMINAN LAS SECUENCIAS

DROP SEQUENCE SEQUENCE_ASISTENTES
DROP SEQUENCE SEQUENCE_CAPACITACION
DROP SEQUENCE SEQUENCE_MEJORAS
DROP SEQUENCE SEQUENCE_PAGOSCLIENTES

--SE CREA LA TABLA ACCIDENTE

CREATE TABLE ACCIDENTE (
    ACCIDENTEID         NUMBER(9) PRIMARY KEY,
    ACCIFECHA           DATE NOT NULL,
    ACCIHORA            DATE NOT NULL,
    ACCILUGAR           VARCHAR2(150 BYTE) NOT NULL,
    ACCIORIGEN          VARCHAR2(100 BYTE) NOT NULL,
    ACCICONSECUENCIA    VARCHAR2(100 BYTE),
    CLIENTE_RUTCLIENTE  NUMBER(9) NOT NULL);
    

--SE CREA LA TABLA ADMINISTRATIVO

CREATE TABLE ADMINISTRATIVO (

    RUN          NUMBER(9) PRIMARY KEY,
    NOMBRES      VARCHAR2(50),
    APELLIDOS    VARCHAR2(50),
    CORREO       VARCHAR2(50),
    AREA         VARCHAR2(30),
    USUARIO_RUN  NUMBER(9) NOT NULL );


--SE CREA LA TABLA ASESORIAS

CREATE TABLE ASESORIAS (
    IDASESORIA           NUMBER(9) PRIMARY KEY,
    FECHAREALIZACION     DATE,
    MOTIVO               VARCHAR2(100),
    PROFESIONAL_A_CARGO  VARCHAR2(20),
    PROFESIONAL_RUN      NUMBER(9) NOT NULL);

--SE CREA LA TABLA ASISTENTES

CREATE TABLE ASISTENTES (
    IDASISTENTE                  NUMBER(9) PRIMARY KEY,
    ASISTNOMBRECOMPLETO          VARCHAR2(100 BYTE) NOT NULL,
    ASISTEDAD                    NUMBER(3) NOT NULL,
    ASISTCORREO                  VARCHAR2(70 BYTE),
    ASISTTELEFONO                VARCHAR2(20 BYTE),
    CAPACITACION_IDCAPACITACION  NUMBER(9) NOT NULL);

--SE CREA LA TABLA CAPACITACION

CREATE TABLE CAPACITACION (
    IDCAPACITACION      NUMBER(9) PRIMARY KEY,
    CAPFECHA            DATE NOT NULL,
    CAPHORA             DATE,
    CAPLUGAR            VARCHAR2(100 BYTE) NOT NULL,
    CAPDURACION         NUMBER(4),
    CLIENTE_RUTCLIENTE  NUMBER(9) NOT NULL);

--SE CREA LA TABLA CHEQUEOS

CREATE TABLE CHEQUEOS (
    IDCHEQUEO      NUMBER(9) PRIMARY KEY,
    NOMBRECHEQUEO  VARCHAR2(50) NOT NULL);

--SE CREA LA TABLA CHEQUEOVISITA

CREATE TABLE CHEQUEOVISITA (
    CHEQUEOS_IDCHEQUEO  NUMBER(9) NOT NULL,
    VISITA_IDVISITA     NUMBER(9) NOT NULL,
    CUMPLIMIENTO        CHAR(1) NOT NULL,
    OBSERVACIONES       VARCHAR2(120));

--SE MODIFICA LA TABLA CHEQUEOVISITA Y SE AGREGA 2 PRIMARY KEY

ALTER TABLE CHEQUEOVISITA ADD CONSTRAINT CHEQUEOVISITA_PK PRIMARY KEY ( CHEQUEOS_IDCHEQUEO,VISITA_IDVISITA );

--SE CREA LA TABLA CLIENTE

CREATE TABLE CLIENTE (
    RUTCLIENTE       NUMBER(9) PRIMARY KEY,
    CLINOMBRES       VARCHAR2(30 BYTE) NOT NULL,
    CLIAPELLIDOS     VARCHAR2(50 BYTE) NOT NULL,
    CLITELEFONO      VARCHAR2(20 BYTE) NOT NULL,
    CLIAFP           VARCHAR2(30 BYTE),
    CLISISTEMASALUD  NUMBER(2),
    CLIDIRECCION     VARCHAR2(100 BYTE) NOT NULL,
    CLICOMUNA        VARCHAR2(50 BYTE) NOT NULL,
    CLIEDAD          NUMBER(3) NOT NULL,
    USUARIO_RUN      NUMBER NOT NULL);

--SE MODIFICA LA TABLA CLIENTE AGREGANDO RESTRICCION AL CAMPO CLISISTEMASALUD, PERMITIENDO SOLO LOS VALORES 1 Y 2

ALTER TABLE CLIENTE ADD CONSTRAINT CK_SISTEMASALUD CHECK ( "CLISISTEMASALUD" = 1  OR "CLISISTEMASALUD" = 2 );

--SE MODIFICA LA TABLA CLIENTE CREANDO RESTRICCION DE VALOR UNICO AL CAMPO CLITELEFONO

ALTER TABLE CLIENTE ADD CONSTRAINT UK_TELEFONO UNIQUE ( CLITELEFONO );


--SE CREA LA TABLA MEJORAS

CREATE TABLE MEJORAS (
    IDMEJORA              NUMBER(9) PRIMARY KEY,
    TITULOMEJORA          VARCHAR2(75),
    DESCRIPCIONMEJORA     VARCHAR2(100),
    PLAZORESOLUCION       NUMBER(3),
    ASESORIAS_IDASESORIA  NUMBER(9) NOT NULL);

--SE CREA LA TABLA PAGOSCLIENTE

CREATE TABLE PAGOSCLIENTE (
    IDPAGOCLIENTE       NUMBER(9) PRIMARY KEY,
    FECHAPAGO           DATE,
    MONTOPAGO           NUMBER(10),
    MESPAGO             VARCHAR2(20),
    AÑOPAGO             NUMBER(4),
    CLIENTE_RUTCLIENTE  NUMBER(9) NOT NULL);

--SE CREA LA TABLA PROFESIONAL

CREATE TABLE PROFESIONAL (
    RUN          NUMBER(9) PRIMARY KEY,
    NOMBRES      VARCHAR2(50),
    APELLIDOS    VARCHAR2(50),
    TELEFONO     NUMBER(9),
    TITULO       VARCHAR2(50),
    PROYECTO     VARCHAR2(50),
    USUARIO_RUN  NUMBER(9) NOT NULL);

--SE CREA LA TABLA USUARIOS

CREATE TABLE USUARIOS (
    RUN              NUMBER(9) PRIMARY KEY,
    NOMBRE           VARCHAR2(50),
    APELLIDO         VARCHAR2(50),
    FECHANACIMIENTO  DATE);

--SE CREA LA TABLA VISITA

CREATE TABLE VISITA (
    IDVISITA            NUMBER(9) PRIMARY KEY,
    VISFECHA            DATE NOT NULL,
    VISHORA             DATE,
    VISLUGAR            VARCHAR2(50) NOT NULL,
    VISCOMENTARIOS      VARCHAR2(250) NOT NULL,
    CLIENTE_RUTCLIENTE  NUMBER(9) NOT NULL);

--SE CREA LA FOREIGN KEY DE LA CLASE ACCIDENTE

ALTER TABLE ACCIDENTE ADD CONSTRAINT ACCIDENTE_CLIENTE_FK FOREIGN KEY ( CLIENTE_RUTCLIENTE ) REFERENCES CLIENTE ( RUTCLIENTE );

--SE CREA LA FOREIGN KEY DE LA CLASE ADMINISTRATIVO

ALTER TABLE ADMINISTRATIVO ADD CONSTRAINT ADMINISTRATIVO_USUARIOS_FK FOREIGN KEY ( USUARIO_RUN ) REFERENCES USUARIOS ( RUN );

--SE CREA LA FOREIGN KEY DE LA CLASE ASESORIAS

ALTER TABLE ASESORIAS ADD CONSTRAINT ASESORIAS_PROFESIONAL_FK FOREIGN KEY ( PROFESIONAL_RUN ) REFERENCES PROFESIONAL ( RUN );

--SE CREA LA FOREIGN KEY DE LA CLASE ASISTENTES

ALTER TABLE ASISTENTES ADD CONSTRAINT ASISTENTES_CAPACITACION_FK FOREIGN KEY ( CAPACITACION_IDCAPACITACION ) REFERENCES CAPACITACION ( IDCAPACITACION );

--SE CREA LA FOREIGN KEY DE LA CLASE CAPACITACION

ALTER TABLE CAPACITACION ADD CONSTRAINT CAPACITACION_CLIENTE_FK FOREIGN KEY ( CLIENTE_RUTCLIENTE ) REFERENCES CLIENTE ( RUTCLIENTE );

--SE CREA LA PRIMERA FOREIGN KEY DE LA CLASE CHEQUEOVISITA

ALTER TABLE CHEQUEOVISITA ADD CONSTRAINT CHEQUEOVISITA_CHEQUEOS_FK FOREIGN KEY ( CHEQUEOS_IDCHEQUEO ) REFERENCES CHEQUEOS ( IDCHEQUEO );

--SE CREA LA SEGUNDA FOREIGN KEY DE LA CLASE CHEQUEOVISITA

ALTER TABLE CHEQUEOVISITA ADD CONSTRAINT CHEQUEOVISITA_VISITA_FK FOREIGN KEY ( VISITA_IDVISITA ) REFERENCES VISITA ( IDVISITA );

--SE CREA LA FOREIGN KEY DE LA CLASE CLIENTE

ALTER TABLE CLIENTE ADD CONSTRAINT CLIENTE_USUARIOS_FK FOREIGN KEY ( USUARIO_RUN ) REFERENCES USUARIOS ( RUN );

--SE CREA LA FOREIGN KEY DE LA CLASE MEJORAS

ALTER TABLE MEJORAS ADD CONSTRAINT MEJORAS_ASESORIAS_FK FOREIGN KEY ( ASESORIAS_IDASESORIA ) REFERENCES ASESORIAS ( IDASESORIA );

--SE CREA LA FOREIGN KEY DE LA CLASE PAGOSCLIENTES

ALTER TABLE PAGOSCLIENTE ADD CONSTRAINT PAGOSCLIENTE_CLIENTE_FK FOREIGN KEY ( CLIENTE_RUTCLIENTE ) REFERENCES CLIENTE ( RUTCLIENTE );

--SE CREA LA FOREIGN KEY DE LA CLASE PROFESIONAL

ALTER TABLE PROFESIONAL ADD CONSTRAINT PROFESIONAL_USUARIOS_FK FOREIGN KEY ( USUARIO_RUN ) REFERENCES USUARIOS ( RUN );

--SE CREA LA FOREIGN KEY DE LA CLASE VISITA

ALTER TABLE VISITA ADD CONSTRAINT VISITA_CHEQUEOS_FK FOREIGN KEY ( CLIENTE_RUTCLIENTE ) REFERENCES CLIENTE ( RUTCLIENTE );


--SE CREA LA SECUENCIA PARA EL CAMPO IDCAPACITACION DE LA TABLA CAPACITACION

CREATE SEQUENCE SEQUENCE_CAPACITACION
 START WITH     1
 INCREMENT BY   1;

 --SE CREA EL DISPARADOR PARA LA SECUENCIA  CAPACITACION_TRI 

CREATE OR REPLACE TRIGGER  CAPACITACION_TRI
BEFORE INSERT ON CAPACITACION
FOR EACH ROW
WHEN (NEW.IDCAPACITACION IS NULL)
BEGIN
 SELECT SEQUENCE_CAPACITACION.NEXTVAL
 INTO :NEW.IDCAPACITACION
 FROM DUAL;
END;
/

--SE CREA LA SECUENCIA PARA EL CAMPO IDASISTENTE DE LA TABLA ASISTENTES

CREATE SEQUENCE SEQUENCE_ASISTENTES
 START WITH     1
 INCREMENT BY   1;
 
 --SE CREA EL DISPARADOR PARA LA SECUENCIA  ASISTENTES_TRI 
 
 CREATE OR REPLACE TRIGGER  ASISTENTES_TRI
BEFORE INSERT ON ASISTENTES
FOR EACH ROW
WHEN (NEW.IDASISTENTE IS NULL)
BEGIN
 SELECT SEQUENCE_ASISTENTES.NEXTVAL
 INTO :NEW.IDASISTENTE
 FROM DUAL;
END;
/



--SE CREA LA SECUENCIA PARA EL CAMPO IDMEJORA DE LA TABLA MEJORAS

CREATE SEQUENCE SEQUENCE_MEJORAS
START WITH 1 
INCREMENT BY   1;

--SE CREA EL DISPARADOR PARA LA SECUENCIA  MEJORAS_IDMEJORA_SEQ 

CREATE OR REPLACE TRIGGER MEJORAS_TRI
BEFORE INSERT ON MEJORAS
FOR EACH ROW
    WHEN ( NEW.IDMEJORA IS NULL )
BEGIN
    :NEW.IDMEJORA := SEQUENCE_MEJORAS.NEXTVAL;
END;
/

--SE CREA LA SECUENCIA PARA EL CAMPO PAGOSCLIENTESA DE LA TABLA PAGO CLIENTE

CREATE SEQUENCE SEQUENCE_PAGOSCLIENTE
START WITH 1 
INCREMENT BY   1;

--SE CREA EL DISPARADOR PARA LA SECUENCIA PAGOSCLIENTE_IDPAGOCLIENTE_TRG

CREATE OR REPLACE TRIGGER PAGOSCLIENTE_TRI
BEFORE
    INSERT ON PAGOSCLIENTE
    FOR EACH ROW
    WHEN ( NEW.IDPAGOCLIENTE IS NULL )
BEGIN
    :NEW.IDPAGOCLIENTE := SEQUENCE_PAGOSCLIENTE.NEXTVAL;
END;
/

--SE CREAN LOS REGISTROS PARA LA LA TABLA USUARIO

INSERT INTO USUARIOS VALUES (14257985,'FRANCISCA','ARCE',TO_DATE ('14/02/1990','DD/MM/YYYY'));
INSERT INTO USUARIOS VALUES (14789320,'ANTONIO','BERRIOS',TO_DATE ('24/07/1990','DD/MM/YYYY'));
INSERT INTO USUARIOS VALUES (14698000,'CAMILA','MORAGA',TO_DATE ('14/02/1990','DD/MM/YYYY'));


--SE CREAN LOS REGISTROS PARA LA TABLA PROFESIONAL

INSERT INTO PROFESIONAL VALUES(13789147,'PATRICIA MACARENA','ALARCON ORTIZ',987665544,'INGENIERO EN PREVENCION DE RIESGO','CODELCO TENIENTE',14257985);
INSERT INTO PROFESIONAL VALUES(13478965,'FEDERICO ALEXANDER','LOPEZ RODRIGUEZ',920003366,'TECNICO EN PREVENCION DE RIESGO','CODELCO CHUCHICAMATA',14789320);
INSERT INTO PROFESIONAL VALUES(13753159,'ROLANDO JORGE','NAVARRETE OLGUIN',933557788,'INGENIERO AMBIENTAL','CONTRATO FORESTIN',14698000);

--SE CREAN LOS REGISTROS PARA LA LA TABLA ASESORIAS    

INSERT INTO ASESORIAS VALUES(1,TO_DATE ('10/02/2020','DD/MM/YYYY'),'INDUCCION','PATRICIA MACARENA',13789147);
INSERT INTO ASESORIAS VALUES(2,TO_DATE ('20/03/2020','DD/MM/YYYY'),'INDUCCION','ANTONIO BERRIOS',13478965);
INSERT INTO ASESORIAS VALUES(3,TO_DATE ('30/04/2020','DD/MM/YYYY'),'INDUCCION','CAMILA MORAGA',13753159);

--SE CREAN LOS REGISTROS PARA LA TABLA MEJORAS

INSERT INTO MEJORAS (IDMEJORA,TITULOMEJORA,DESCRIPCIONMEJORA,PLAZORESOLUCION,ASESORIAS_IDASESORIA) VALUES(NULL,'COMPRAR CASCOS','COMPRAR CASCOS PARA EVITAR GOLPES EN LA CABEZA',3,1);
INSERT INTO MEJORAS (IDMEJORA,TITULOMEJORA,DESCRIPCIONMEJORA,PLAZORESOLUCION,ASESORIAS_IDASESORIA) VALUES(NULL,'ARREGLAR MALLA','REPARAR MALLA PARA EVITAR HURTOS',5,2);
INSERT INTO MEJORAS (IDMEJORA,TITULOMEJORA,DESCRIPCIONMEJORA,PLAZORESOLUCION,ASESORIAS_IDASESORIA) VALUES(NULL,'IMPRIMIR MANUALES','IMPRIMIR MANUALES DE SEGURIDAD',10,3);

--SE CREAN LOS REGISTROS PARA LA TABLA ADMINISTRATIVO

INSERT INTO ADMINISTRATIVO VALUES (12456987,'ALEJANDRA TAMARA','AEDO GARCIA','A.AEDO@GMAIL.COM','CONTABILIDAD',14257985);
INSERT INTO ADMINISTRATIVO VALUES (12741369,'SILVIA ANDREA','PEREZ GOMEZ','S.PEREZ@GMAIL.COM','RRHH',14789320);
INSERT INTO ADMINISTRATIVO VALUES (12000147,'MARCO ANTONIO','POLO SOLIS','M.POLO@GMAIL.COM','MARKETING',14698000);



---SE CREAN LOS REGISTROS PARA LA TABLA CLIENTE

INSERT INTO CLIENTE VALUES (112549872,'JUAN ANDRES','PEREZ CUEVAS',988445566,'MODELO',1,'LOS OLMOS 345','SANTIAGO',70,14257985);
INSERT INTO CLIENTE VALUES (150004786,'VICTOR HUGO','VENEGAS JORQUERA',944779966,'HABITAD',2,'LAS REJAS 2425','VALPARAISO',30,14789320);
INSERT INTO CLIENTE VALUES (136980123,'MARCELA AGUSTINA','FLORES ANDRADE',900021144,'CUPRUM',1,'VICUÑA MACKEÑÑA 147','TALCA',42,14698000);



--SE CREAN LOS REGISTROS PARA LA TABLA ACCIDENTE

INSERT INTO ACCIDENTE VALUES (1,TO_DATE ('14/02/2020','DD/MM/YYYY'),TO_DATE ('12:00','HH24:MI'),'EN LA EMPRESA','LABORAL','MUERTE',112549872);
INSERT INTO ACCIDENTE VALUES (2,TO_DATE ('15/03/2020','DD/MM/YYYY'),TO_DATE ('15:00','HH24:MI'),'CAMINO A CASA','TRAYECTO','MUERTE',150004786); 
INSERT INTO ACCIDENTE VALUES (3,TO_DATE ('16/04/2020','DD/MM/YYYY'),TO_DATE ('13:00','HH24:MI'),'EN EL PATIO','LABORAL','MUERTE',136980123);


--SE CREAN LOS REGISTROS PARA LA TABLA PAGOSCLIENTE

INSERT INTO PAGOSCLIENTE (IDPAGOCLIENTE,FECHAPAGO,MONTOPAGO,MESPAGO,AÑOPAGO,CLIENTE_RUTCLIENTE) VALUES(NULL, TO_DATE ('14/10/2020','DD/MM/YYYY'),500000,'OCTUBRE',2020,112549872);
INSERT INTO PAGOSCLIENTE (IDPAGOCLIENTE,FECHAPAGO,MONTOPAGO,MESPAGO,AÑOPAGO,CLIENTE_RUTCLIENTE) VALUES(NULL, TO_DATE ('14/11/2020','DD/MM/YYYY'),1000000,'NOVIEMBRE',2020,150004786);
INSERT INTO PAGOSCLIENTE (IDPAGOCLIENTE,FECHAPAGO,MONTOPAGO,MESPAGO,AÑOPAGO,CLIENTE_RUTCLIENTE) VALUES(NULL, TO_DATE ('14/12/2020','DD/MM/YYYY'),1500000,'DICIEMBRE',2020,136980123);



--SE CREAN LOS REGISTROS PARA LA TABLA CAPACITACION

INSERT INTO CAPACITACION (IDCAPACITACION,CAPFECHA,CAPHORA,CAPLUGAR,CAPDURACION,CLIENTE_RUTCLIENTE)  VALUES (NULL,TO_DATE ('01/11/2020','DD/MM/YYYY'),TO_DATE ('13:00','HH24:MI'),'SANTIAGO',70,112549872);
INSERT INTO CAPACITACION (IDCAPACITACION,CAPFECHA,CAPHORA,CAPLUGAR,CAPDURACION,CLIENTE_RUTCLIENTE)  VALUES (NULL,TO_DATE ('10/11/2020','DD/MM/YYYY'),TO_DATE ('16:00','HH24:MI'),'VALPARAISO',50,150004786);
INSERT INTO CAPACITACION (IDCAPACITACION,CAPFECHA,CAPHORA,CAPLUGAR,CAPDURACION,CLIENTE_RUTCLIENTE)  VALUES (NULL,TO_DATE ('15/11/2020','DD/MM/YYYY'),TO_DATE ('18:00','HH24:MI'),'PUERTO MONTT',20,136980123);



--SE CREAN LOS REGISTROS PARA LA TABLA ASISTENTES

INSERT INTO ASISTENTES (IDASISTENTE,ASISTNOMBRECOMPLETO,ASISTEDAD,ASISTCORREO,ASISTTELEFONO,CAPACITACION_IDCAPACITACION)  VALUES (NULL,'ALAN BRITO',33,'A.BRITO@GMAIL.COM','988771510',1);
INSERT INTO ASISTENTES (IDASISTENTE,ASISTNOMBRECOMPLETO,ASISTEDAD,ASISTCORREO,ASISTTELEFONO,CAPACITACION_IDCAPACITACION)  VALUES (NULL,'ELVIS TECK',25,'E.TECK@GMAIL.COM','966551510',2);
INSERT INTO ASISTENTES (IDASISTENTE,ASISTNOMBRECOMPLETO,ASISTEDAD,ASISTCORREO,ASISTTELEFONO,CAPACITACION_IDCAPACITACION)  VALUES (NULL,'ANDRES LOPEZ',45,'A.LOPEZ@GMAIL.COM','966551511',3);



--SE CREAN LOS REGISTROS PARA LA TABLA VISITA


INSERT INTO VISITA VALUES(1,TO_DATE ('05/11/2020','DD/MM/YYYY'),TO_DATE ('13:00','HH24:MI'),'LA PRADERA','LE PICARON BICHOS',112549872);
INSERT INTO VISITA VALUES(2,TO_DATE ('06/11/2020','DD/MM/YYYY'),TO_DATE ('13:00','HH24:MI'),'SEDE CENTRAL','NO SE RESOLVIO',150004786);
INSERT INTO VISITA VALUES(3,TO_DATE ('09/11/2020','DD/MM/YYYY'),TO_DATE ('13:00','HH24:MI'),'CASA MATRIZ','FALTA LIBRO DE REGISTROS',136980123);

--SE CREAN LOS REGISTROS PARA LA TABLA CHEQUEO

INSERT INTO CHEQUEOS VALUES(1,'REVISION');
INSERT INTO CHEQUEOS VALUES(2,'INSPECCION DE INSTALACIONES');
INSERT INTO CHEQUEOS VALUES(3,'ANALISIS DE COSTO');

--SE CREAN LOS REGISTROS PARA LA TABLA CHEQUEOVISITA

INSERT INTO CHEQUEOVISITA (CHEQUEOS_IDCHEQUEO,VISITA_IDVISITA,CUMPLIMIENTO) VALUES(1,1,'N');
INSERT INTO CHEQUEOVISITA (CHEQUEOS_IDCHEQUEO,VISITA_IDVISITA,CUMPLIMIENTO) VALUES(2,2,'Y');
INSERT INTO CHEQUEOVISITA VALUES(3,3,'Y','SE CUMPLIO EL CHEQUEO');


